<div class="alerts-container">
  <!-- Header -->
  <div class="header">
    <h1>
      <mat-icon>notifications</mat-icon>
      Alertes
      <span class="unread-badge" *ngIf="unreadCount > 0">{{ unreadCount }}</span>
    </h1>
    <div class="header-actions">
      <button mat-raised-button color="primary" (click)="generateAlerts()" [disabled]="loading">
        <mat-icon>refresh</mat-icon>
        Actualiser les alertes
      </button>
      <button mat-button (click)="markAllAsRead()" [disabled]="unreadCount === 0">
        <mat-icon>done_all</mat-icon>
        Tout marquer comme lu
      </button>
    </div>
  </div>

  <!-- Filtres -->
  <mat-button-toggle-group [value]="filter" (change)="setFilter($event.value)" class="filter-group">
    <mat-button-toggle value="all">
      Toutes ({{ alerts.length }})
    </mat-button-toggle>
    <mat-button-toggle value="unread">
      Non lues ({{ unreadCount }})
    </mat-button-toggle>
  </mat-button-toggle-group>

  <!-- Loading -->
  <div *ngIf="loading" class="loading-container">
    <mat-spinner diameter="50"></mat-spinner>
    <p>Chargement des alertes...</p>
  </div>

  <!-- Liste des alertes -->
  <div *ngIf="!loading && filteredAlerts.length > 0" class="alerts-list">
    <mat-card *ngFor="let alert of filteredAlerts" 
              [class.alert-card]="true"
              [class.unread]="!alert.isRead"
              [ngClass]="getSeverityClass(alert.severity)">
      
      <!-- Icône de sévérité -->
      <div class="alert-icon">
        <mat-icon [ngClass]="getSeverityClass(alert.severity)">
          {{getSeverityIcon(alert.severity)}}
        </mat-icon>
      </div>

      <!-- Contenu de l'alerte -->
      <div class="alert-content">
        <div class="alert-header">
          <h3>{{alert.title}}</h3>
          <span class="alert-badge" [ngClass]="getSeverityClass(alert.severity)">
            {{getTypeLabel(alert.type)}}
          </span>
        </div>

        <p class="alert-message">{{alert.message}}</p>

        <div class="alert-meta">
          <span class="alert-time">
            <mat-icon>schedule</mat-icon>
            {{getRelativeTime(alert.createdAt)}}
          </span>
          
          <span *ngIf="alert.budgetCategoryName" class="alert-category">
            <mat-icon>category</mat-icon>
            {{alert.budgetCategoryName}}
          </span>
          
          <span *ngIf="alert.goalName" class="alert-goal">
            <mat-icon>flag</mat-icon>
            {{alert.goalName}}
          </span>
        </div>
      </div>

      <!-- Actions -->
      <div class="alert-actions">
        <button mat-icon-button 
                *ngIf="!alert.isRead"
                (click)="markAsRead(alert)"
                matTooltip="Marquer comme lu">
          <mat-icon>done</mat-icon>
        </button>

        <button mat-icon-button 
                *ngIf="alert.budgetId"
                (click)="navigateToBudget(alert.budgetId)"
                matTooltip="Voir le budget">
          <mat-icon>arrow_forward</mat-icon>
        </button>

        <button mat-icon-button 
                *ngIf="alert.goalId"
                (click)="navigateToGoal(alert.goalId)"
                matTooltip="Voir l'objectif">
          <mat-icon>arrow_forward</mat-icon>
        </button>

        <button mat-icon-button 
                (click)="deleteAlert(alert)"
                matTooltip="Supprimer"
                color="warn">
          <mat-icon>delete</mat-icon>
        </button>
      </div>
    </mat-card>
  </div>

  <!-- Empty state -->
  <div *ngIf="!loading && filteredAlerts.length === 0" class="empty-state">
    <mat-icon>notifications_none</mat-icon>
    <h2>Aucune alerte</h2>
    <p *ngIf="filter === 'all'">Vous n'avez aucune alerte pour le moment.</p>
    <p *ngIf="filter === 'unread'">Vous n'avez aucune alerte non lue.</p>
    <button mat-raised-button color="primary" (click)="generateAlerts()">
      <mat-icon>refresh</mat-icon>
      Générer les alertes
    </button>
  </div>
</div>
